namespace = disasters_inv

disasters_inv.1 = { #flood in flood_plain
	type = country_event
	title = disasters_inv.1.t
	desc = disasters_inv.1.desc
	picture = natural_disaster

	left_portrait = current_ruler
	right_portrait = scope:the_day_after.governor
	goto_location = scope:the_day_after

	trigger = {
		any_owned_province = {
			terrain = flood_plain
		}
		NOT = {
			has_variable = floods_cooldown
		}
	}

	immediate = {
		random_owned_province = {
			limit = {
				terrain = flood_plain
				total_population >= 4
			}
			save_scope_as = the_day_after
			set_variable = {
				name = num_of_of_victims
				days = 3
				value = total_population
			}
			add_province_modifier = {
				name = flood_initial_damage
				duration = 730
			}
			random_pops_in_province = {
				while = {
					count = {
						value = var:num_of_of_victims
						multiply = 0.25
					}
					kill_pop = yes
				}
			}
			custom_tooltip = disasters_inv_destroyed_building
			hidden_effect = {
				random_list = {
					1 = {
						trigger = { has_building = commerce_building }
						remove_building_level = commerce_building
					}
					1 = {
						trigger = { has_building = library_building }
						remove_building_level = library_building
					}
					1 = {
						trigger = { has_building = theathre_building }
						remove_building_level = theathre_building
					}
					1 = {
						trigger = { has_building = academy_building }
						remove_building_level = academy_building
					}
					1 = {
						trigger = { has_building = population_building } # granary
						remove_building_level = population_building
					}
					1 = {
						trigger = { has_building = forum_building }
						remove_building_level = forum_building
					}
					1 = {
						trigger = { has_building = workshop_building }
						remove_building_level = workshop_building
					}
					1 = {
						trigger = { has_building = port_building }
						remove_building_level = port_building
					}
					8 = {}
				}
			}
		}
	}

	option = { #secure the area
		name = disasters_inv.1.a
		add_treasury = {
			subtract = has_monthly_income
			multiply = 4
		}
		trigger_event = {
			id = disasters_inv.3
			days = { 10 20 }
		}
	}

	option = { #greedy bastard
		name = disasters_inv.1.b
		hidden_effect = {
			if = {
				limit = {
					scope:the_day_after = {
						any_neighbor_province = {
							exists = owner
							owner = root
							OR = {
								terrain = flood_plain
								terrain = farmland
								terrain = plains
							}
						}
					}
				}
				random = {
					chance = 50
					trigger_event = {
						id = disasters_inv.2
						days = { 1 7 }
					}
				}
			}
		}
	}

	after = {
		set_variable = {
			name = floods_cooldown
			days = 18250 #25yrs
		}
	}
}

disasters_inv.2 = { #spread of the flood
	type = country_event
	title = disasters_inv.2.t
	desc = disasters_inv.2.desc
	picture = natural_disaster

	left_portrait = current_ruler
	right_portrait = scope:the_day_after.governor
	goto_location = scope:the_day_after

	immediate = {
		if = {
			limit = {
				scope:the_day_after = {
					any_neighbor_province = {
						exists = owner
						owner = root
						OR = {
							terrain = flood_plain
							terrain = farmland
							terrain = plains
						}
					}
				}
			}
			scope:the_day_after = {
				every_neighbor_province = {
					add_province_modifier = {
						name = flood_reduced_damage
						duration = 365
					}
					hidden_effect = {
						random_list = {
							1 = {
								trigger = { has_building = commerce_building }
								remove_building_level = commerce_building
							}
							1 = {
								trigger = { has_building = library_building }
								remove_building_level = library_building
							}
							1 = {
								trigger = { has_building = theathre_building }
								remove_building_level = theathre_building
							}
							1 = {
								trigger = { has_building = academy_building }
								remove_building_level = academy_building
							}
							1 = {
								trigger = { has_building = population_building } # granary
								remove_building_level = population_building
							}
							1 = {
								trigger = { has_building = forum_building }
								remove_building_level = forum_building
							}
							1 = {
								trigger = { has_building = workshop_building }
								remove_building_level = workshop_building
							}
							1 = {
								trigger = { has_building = port_building }
								remove_building_level = port_building
							}
							8 = {}
						}
					}
				}
			}
		}
	}

	option = {
		name = disasters_inv.2.a
		trigger_event = {
			id = disasters_inv.3
			days = { 1 7 }
		}
	}
}

disasters_inv.3 = { #flood receding
	type = country_event
	title = disasters_inv.3.t
	desc = disasters_inv.3.desc
	picture = natural_disaster

	left_portrait = current_ruler
	right_portrait = scope:the_day_after.governor
	goto_location = scope:the_day_after

	option = {
		name = disasters_inv.3.a
	}
}

disasters_inv.4 = {
	type = country_event
	title = disasters_inv.4.t
	desc = disasters_inv.4.desc
	picture = natural_disaster

	left_portrait = current_ruler
	right_portrait = scope:snowball.governor
	goto_location = scope:snowball

	trigger = {
		any_owned_province = {
			terrain = mountain
		}
		NOT = {
			has_variable = avalanche_cooldown
		}
	}

	immediate = {
		random_owned_province = {
			limit = {
				terrain = mountain
				total_population >= 4
			}
			if = {
				limit = {
					NOT = {
						owner = {
							any_owned_province = {
								this = scope:snowball
							}
						}
					}
				}
				save_scope_as = snowball
			}
			set_variable = {
				name = num_of_of_victims
				days = 2
				value = total_population
			}
			add_province_modifier = {
				name = hit_by_avalanche
				duration = 730
			}
			random_pops_in_province = {
				while = {
					count = {
						value = var:num_of_of_victims
						multiply = 0.4
					}
					kill_pop = yes
				}
			}
			custom_tooltip = disasters_inv_destroyed_building
			hidden_effect = {
				random_list = {
					1 = {
						trigger = { has_building = commerce_building }
						remove_building_level = commerce_building
					}
					1 = {
						trigger = { has_building = library_building }
						remove_building_level = library_building
					}
					1 = {
						trigger = { has_building = theathre_building }
						remove_building_level = theathre_building
					}
					1 = {
						trigger = { has_building = academy_building }
						remove_building_level = academy_building
					}
					1 = {
						trigger = { has_building = population_building } # granary
						remove_building_level = population_building
					}
					1 = {
						trigger = { has_building = forum_building }
						remove_building_level = forum_building
					}
					1 = {
						trigger = { has_building = workshop_building }
						remove_building_level = workshop_building
					}
					1 = {
						trigger = { has_building = port_building }
						remove_building_level = port_building
					}
					8 = {}
				}
			}
		}
	}

	option = {
		name = disasters_inv.4.a
	}

	after = {
		if = {
			limit = {
				scope:snowball = {
					any_neighbor_province = {
						terrain = mountain
						NOT = {
							has_province_modifier = hit_by_avalanche
						}
					}
				}
			}
			scope:snowball = {
				clear_saved_scope = snowball
				random_neighbor_province = {
					limit = {
						terrain = mountain
						NOT = {
							has_province_modifier = hit_by_avalanche
						}
					}
					random = {
						chance = 50
						save_scope_as = snowball
						owner = {
							trigger_event = {
								id = disasters_inv.4
								days = { 3 5 }
							}
						}
					}
				}
			}
		}
	}

}